
<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="sv" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="sv"> <!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Kodanka - Webbskrapning</title>
<link href="../_static/logo.png" rel="shortcut icon"/>
<script src="../_static/js/modernizr.min.js" type="text/javascript"></script>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js" type="text/javascript"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/language_data.js"></script>
<script src="../_static/translations.js"></script>
<script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"equationNumbers": {"autoNumber": "AMS", "useLabelIds": true}}, "tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
<script src="../_static/js/theme.js" type="text/javascript"></script>
<link href="../_static/css/theme.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../genindex/" rel="index" title="Index"/>
<link href="../search/" rel="search" title="Sök"/>
<link href="../latex/" rel="prev" title="LaTeX"/>
</head>
<body class="wy-body-for-nav">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href="../"> Kodanka
          

          
            
            <img alt="Logo" class="logo" src="../_static/logo.png"/>
</a>
<div role="search">
<form action="../search/" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Sök" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption"><span class="caption-text">Info:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../instruktioner/">Instruktioner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installationer/">Installationer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../om-kodanka/">Om Kodanka</a></li>
</ul>
<p class="caption"><span class="caption-text">Grunder:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../inledning/">Inledning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operationer/">Tal och räkneoperationer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operationer/#Strängar">Strängar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operationer/#Variabler">Variabler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../listor/">Listor</a></li>
</ul>
<p class="caption"><span class="caption-text">Fördjupat:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../latex/">LaTeX</a></li>
</ul>
<p class="caption"><span class="caption-text">Projekt:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Webbskrapning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Dagens-nyheter">Dagens nyheter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Hitta-HTML-element">Hitta HTML element</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Spara-innehåll-i-listor">Spara innehåll i listor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Skapa-en-tabell">Skapa en tabell</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Konsol">Konsol</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Quiz">Quiz</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="top navigation" class="wy-nav-top">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="../">Kodanka</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs"><a href="https://colab.research.google.com/github/kodanka/kodanka.fi/blob/master/webbskrapning.ipynb" rel="noopener noreferrer" target="_blank"><img alt="Öppna i Colab" src="../_static/colab-badge.svg" style="width: 117px; height: 20px;"/></a>



</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div itemprop="articleBody">
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Webbskrapning">
<h1>Webbskrapning<a class="headerlink" href="#Webbskrapning" title="Permalink till denna rubrik">¶</a></h1>
<p>Webbskrapning (<em>eng. web scraping</em>) går ut på att automatisera sökandet av information från sidor på nätet. Här är några motiveringar till varför man kan göra det:</p>
<ul class="simple">
<li><p>När den data du behöver inte finns färdigt samlad</p></li>
<li><p>I forskningssyfte för att skaffa information</p></li>
<li><p>I kommersiellt syfte för att analysera kunders val på nätet och automatisera marknadsföring</p></li>
</ul>
<p>Men är det lagligt? Jo, så länge man skrapar allmänt tillgänglig data:</p>
<ul class="simple">
<li><p>Användaren har gjort datan offentlig</p></li>
<li><p>Det krävs inget konto för att nå datan</p></li>
<li><p>Sidan är inte blockerad av en <code class="docutils literal notranslate"><span class="pre">robots.txt</span></code> fil</p></li>
</ul>
<p>Som exempel har Yle en sådan fil med restriktioner, <a class="reference external" href="https://yle.fi/robots.txt">https://yle.fi/robots.txt</a>. Vi tar och ser vad den innehåller. Ett lätt sätt att ladda sidor från internet i Python är genom att använda <code class="docutils literal notranslate"><span class="pre">requests.get()</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">restriktioner</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://yle.fi/robots.txt'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">restriktioner</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
User-agent: *
Disallow: /ylefiroot-errors
Disallow: /cgi-bin
Disallow: /klaffi
Disallow: /java
Disallow: /player
Disallow: /errorsivut/
Disallow: /global/
Disallow: /haku/
Disallow: /eurovision/
Disallow: /embed/
Allow: /global/api/load.php
Allow: /cgi-bin/tekstitv/ttv.cgi/


#yle.fi/aihe, aka. FYND - contact drupal@yle.fi if needed
Disallow: /aihe/flag/
Disallow: /aihe/ajax_comments/
Disallow: /aihe/comment/reply/

# karttasovellus APla 9.7.2015
Disallow: /karttasovellus/
</pre></div></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">User-agent:</span> <span class="pre">*</span></code> i filen innebär att restriktionerna gäller alla sorters robotar</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Disallow:</span> <span class="pre">/eurovision/</span></code> innebär att robotar inte får skrapa t.ex. <a class="reference external" href="https://yle.fi/eurovision/">https://yle.fi/eurovision/</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Övning 1</p>
<p>Sök på olika sidor som du brukar använda ifall de har en <code class="docutils literal notranslate"><span class="pre">robots.txt</span></code> fil. Försök förstå vilka sidor de avråder robotar från att besöka. Om du vill veta mer om <em>The Robots Exclusion Protocol</em> hittar man information här <a class="reference external" href="https://www.robotstxt.org">https://www.robotstxt.org</a>.</p>
</div>
<div class="section" id="Dagens-nyheter">
<h2>Dagens nyheter<a class="headerlink" href="#Dagens-nyheter" title="Permalink till denna rubrik">¶</a></h2>
<p>Nu ska vi se om vi lyckas skrapa Svenska Yles framsida för att få dagens nyheter listade. Vi börjar med att importera <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> som är ett paket i Python för att navigera HTML (HyperText Markup Language), d.v.s. språket som webbsidor skrivs i. Sedan söker vi sidan på nätet med <code class="docutils literal notranslate"><span class="pre">requests</span></code> paketet igen och omvandlar sidans innehåll med en HTML parser till en s.k. <em>soppa</em> som <code class="docutils literal notranslate"><span class="pre">Beautifulsoup</span></code> kan hantera. En parser är något som förstår syntaxen (regler, grammatik, uppbyggnad) för ett
språk som i vårt fall är HTML.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">yle</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://svenska.yle.fi'</span><span class="p">)</span>
<span class="n">soppa</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">yle</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Hitta-HTML-element">
<h3>Hitta HTML element<a class="headerlink" href="#Hitta-HTML-element" title="Permalink till denna rubrik">¶</a></h3>
<p>Man kan hitta information i sidan med <code class="docutils literal notranslate"><span class="pre">find()</span></code>, vi söker sidans titel som syns uppe i sidans flik i sökmotorn. HTML använder <code class="docutils literal notranslate"><span class="pre">&lt;tagg&gt;&lt;/tagg&gt;</span></code> för olika typer av innehåll, och genom att byta ut <code class="docutils literal notranslate"><span class="pre">tagg</span></code> till t.ex. <code class="docutils literal notranslate"><span class="pre">title</span></code> = titel, <code class="docutils literal notranslate"><span class="pre">header</span></code> = sidhuvud eller <code class="docutils literal notranslate"><span class="pre">footer</span></code> = sidfot får man olika sorters element på webbsidor.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">titel</span> <span class="o">=</span> <span class="n">soppa</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'title'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">titel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;title&gt;Svenska Yle&lt;/title&gt;
</pre></div></div>
</div>
<p>Sedan kollar vi på sidhuvudet som ofta har lite inledande information samt länkar för att navigera sidan. Själva länkarna finner vi genom HTML taggen <code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code>, man kan få alla på en gång som en lista genom att använda <code class="docutils literal notranslate"><span class="pre">find_all()</span></code>. Själva webaddressen finns i HTML under <code class="docutils literal notranslate"><span class="pre">href</span></code>. Man kan göra det lite snyggare då man skriver ut <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> element genom att använda <code class="docutils literal notranslate"><span class="pre">prettify()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sidhuvud</span> <span class="o">=</span> <span class="n">soppa</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'header'</span><span class="p">)</span>
<span class="n">sidhuvud_lankar</span> <span class="o">=</span> <span class="n">sidhuvud</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sidhuvud_lankar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;a href="https://svenska.yle.fi" id="yle-header-main-link--svenska-yle" tabindex="0"&gt;
 Svenska Yle
&lt;/a&gt;

</pre></div></div>
</div>
<p>Eftersom vi sökte länkarna som en lista kan man loopa igenom dem och deras texter! Man får texten för ett <code class="docutils literal notranslate"><span class="pre">Beautifulsoup</span></code> element med <code class="docutils literal notranslate"><span class="pre">text</span></code> funktionen och länkar fås med <code class="docutils literal notranslate"><span class="pre">get('href')</span></code>. Här skrivs allt ut som <code class="docutils literal notranslate"><span class="pre">f-strängar</span></code> för att få enhetliga mellanrum mellan text och länkar.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">lank</span> <span class="ow">in</span> <span class="n">sidhuvud_lankar</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">lank</span><span class="o">.</span><span class="n">text</span><span class="si">:</span><span class="s2">20s</span><span class="si">}{</span><span class="n">lank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
svenska.yle.fi      https://svenska.yle.fi
Svenska Yle         https://svenska.yle.fi
Arenan              https://arenan.yle.fi/tv
Ämnen               https://svenska.yle.fi/lista/amnessidor
Svenska Yle         https://svenska.yle.fi
Arenan              https://arenan.yle.fi/tv
Inrikes             https://svenska.yle.fi/inrikes
Sport               https://svenska.yle.fi/sport
Utrikes             https://svenska.yle.fi/utrikes
Kultur              https://svenska.yle.fi/kultur
Familj              https://svenska.yle.fi/familj
Kunskap             https://svenska.yle.fi/vetamix
Huvudstadsregionen  https://svenska.yle.fi/huvudstadsregionen
Västnyland          https://svenska.yle.fi/vastnyland
Åboland             https://svenska.yle.fi/aboland
Österbotten         https://svenska.yle.fi/osterbotten
Östnyland           https://svenska.yle.fi/ostnyland
Kontakta oss        https://svenska.yle.fi/respons
Radio-guide         https://arenan.yle.fi/radio/guide
TV-guide            https://arenan.yle.fi/tv/guide
Etusivu suomeksi    https://yle.fi
Fler ämnen          https://svenska.yle.fi/lista/amnessidor
Mitt konto          https://tunnus.yle.fi/#mina-uppgifter
</pre></div></div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Övning 2</p>
<p>Se vad du hittar för länkar i sidfoten på <a class="reference external" href="https://svenska.yle.fi">https://svenska.yle.fi</a>, tips: börja med att söka på <code class="docutils literal notranslate"><span class="pre">footer</span></code>. Skriv ut webbadresserna tillsammans med deras texter. Här är en grund för programmet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">yle</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://svenska.yle.fi'</span><span class="p">)</span>
<span class="n">soppa</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">yle</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Spara-innehåll-i-listor">
<h3>Spara innehåll i listor<a class="headerlink" href="#Spara-innehåll-i-listor" title="Permalink till denna rubrik">¶</a></h3>
<p>Nyheterna som vi är intresserade av att hitta finns i huvudinnehållet i sidan innanför <code class="docutils literal notranslate"><span class="pre">&lt;body&gt;...&lt;/body&gt;</span></code> så vi börjar med att söka på det.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">innehall</span> <span class="o">=</span> <span class="n">soppa</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"body"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Rubriker i HTML finns innanför <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;h2&gt;</span></code>, o.s.v. beroende på vilken nivå/storlekt rubriken har. Vi ser om vi hittar något som skulle likna en nyhet.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">innehall</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">)</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">innehall</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'h2'</span><span class="p">)</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;h1 class="visually-hidden"&gt;
 Innehåll från svenska.yle.fi
&lt;/h1&gt;

&lt;h2 class="visually-hidden focusable"&gt;
 Huvudinnehåll
&lt;/h2&gt;
</pre></div></div>
</div>
<p>Det verkar som att <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> och <code class="docutils literal notranslate"><span class="pre">&lt;h2&gt;</span></code> inte fungerar so nyhetsubriker på sidan, men se däremot på <code class="docutils literal notranslate"><span class="pre">&lt;h3&gt;</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">innehall</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;h3 class="js-ydd-card-title flex txt-16"&gt;
 Ted &amp;amp; Kaj: Din mamma var en sköldpadda
&lt;/h3&gt;

</pre></div></div>
</div>
<p>Nu vet vi hur vi hittar nyhternas rubriker, men vad är de utan länkar till själva nyheten? Dem kan vi hitta genom att igen söka på alla <code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code> taggar.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">innehall_lankar</span> <span class="o">=</span> <span class="n">innehall</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Vi vill hitta de länkar som är associerade till en nyhetsrubrik, så vi söker efter rubrik taggen <code class="docutils literal notranslate"><span class="pre">&lt;h3&gt;</span></code> i varje länk. Nu för att se att det fungerar avslutas loopen med <code class="docutils literal notranslate"><span class="pre">break</span></code> efter att vi hittat den första rubriken. För att få bort onödiga mellanrum som finns kring en del rubriker använder vi <code class="docutils literal notranslate"><span class="pre">strip()</span></code> funktionen.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">lank</span> <span class="ow">in</span> <span class="n">innehall_lankar</span><span class="p">:</span>
  <span class="n">rubrik</span> <span class="o">=</span> <span class="n">lank</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'h3'</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">rubrik</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Rubrik:'</span><span class="p">,</span> <span class="n">rubrik</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'Länk:'</span><span class="p">,</span> <span class="n">lank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'href'</span><span class="p">))</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Rubrik: Ted &amp; Kaj: Din mamma var en sköldpadda
Länk: https://arenan.yle.fi/1-50576822
</pre></div></div>
</div>
<p>Det ser ju bra ut, då gör vi lika för alla länkar i innehållet och sparar resultatet i två listor, <code class="docutils literal notranslate"><span class="pre">nyhetsrubriker</span></code> och <code class="docutils literal notranslate"><span class="pre">nyhetslankar</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nyhetsrubriker</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">nyhetslankar</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">lank</span> <span class="ow">in</span> <span class="n">innehall_lankar</span><span class="p">:</span>
  <span class="n">rubrik</span> <span class="o">=</span> <span class="n">lank</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'h3'</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">rubrik</span><span class="p">:</span>
    <span class="n">nyhetsrubriker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rubrik</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">nyhetslankar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'href'</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle">Övning 3</p>
<p>Det finns flera hundra robotar listade på <a class="reference external" href="https://www.robotstxt.org/db.html">https://www.robotstxt.org/db.html</a>, spara robotarnas namn och webaddresser i varsin lista. Tips: <code class="docutils literal notranslate"><span class="pre">find_all()</span></code> och <code class="docutils literal notranslate"><span class="pre">&lt;li&gt;</span></code> (<em>eng. list item</em>) som är en tagg för listade element.</p>
<p>Man kan se hela sidans innehåll så här:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">robotar</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://www.robotstxt.org/db.html'</span><span class="p">)</span>
<span class="n">soppa</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">robotar</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">soppa</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
</pre></div>
</div>
<p>Ett annat mycket bra sätt att se sidans uppbyggnad är att besöka sidan, högerklicka på den och välja <code class="docutils literal notranslate"><span class="pre">Visa</span> <span class="pre">sidkälla</span></code>, <a class="reference external" href="view-source:https://www.robotstxt.org/db.html">view-source:https://www.robotstxt.org/db.html</a>.</p>
</div>
</div>
<div class="section" id="Skapa-en-tabell">
<h3>Skapa en tabell<a class="headerlink" href="#Skapa-en-tabell" title="Permalink till denna rubrik">¶</a></h3>
<p>Det skulle vara snyggt att visa nyheterna i tabellform så vi använder oss av paketet <code class="docutils literal notranslate"><span class="pre">pandas</span></code> som är bra på just det. Man anger kolumnernas namn som nycklar och listorna som värden i ett Python dictionary.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">nyheter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Rubrik'</span><span class="p">:</span> <span class="n">nyhetsrubriker</span><span class="p">,</span> <span class="s1">'Länk'</span><span class="p">:</span> <span class="n">nyhetslankar</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>Rubrikerna och länkarna kan vara väldigt långa så för att undvika att de kapas av automatiskt sätter vi <code class="docutils literal notranslate"><span class="pre">max_colwidth</span></code> till <code class="docutils literal notranslate"><span class="pre">None</span></code>, det gör att det inte finns nån maximal bredd för tabellens innehåll. Men hur vet man att man ska ändra på just någon sån parameter? Det lär man sig genom att söka på nätet, oftast landar man på <a class="reference external" href="https://stackoverflow.com/questions/25351968/how-to-display-full-non-truncated-dataframe-information-in-html-when-convertin">Stack Overflow</a> då det handlar om
programmeringstips. Det är bra att veta att alla programmerare konstant söker information på internet eftersom det är omöjligt att veta och minnas hur man ska koda olika saker.</p>
<p>Till slut skriver vi ut topp 10 nyheterna!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_colwidth'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">nyheter</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Rubrik</th>
<th>Länk</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Ted &amp; Kaj: Din mamma var en sköldpadda</td>
<td>https://arenan.yle.fi/1-50576822</td>
</tr>
<tr>
<th>1</th>
<td>Senaste nytt om coronaviruset</td>
<td>https://svenska.yle.fi/coronavirus</td>
</tr>
<tr>
<th>2</th>
<td>Jobb som bärplockare är ökänt för dåliga arbetsförhållanden men så ska det inte vara: "Det är viktigt att alla behandlas lika oavsett varifrån de kommer"</td>
<td>https://svenska.yle.fi/artikel/2020/07/01/jobb-som-barplockare-ar-okant-for-daliga-arbetsforhallanden-men-sa-ska-det-inte</td>
</tr>
<tr>
<th>3</th>
<td>Tusentals Hongkongbor ute på gatorna i protest mot ny inskränkande lag - polisen grep människor med hänvisning till lagen</td>
<td>https://svenska.yle.fi/artikel/2020/07/01/tusentals-hongkongbor-ute-pa-gatorna-i-protest-mot-ny-inskrankande-lag-polisen</td>
</tr>
<tr>
<th>4</th>
<td>Hongkongborna uppmärksammade 23 år under kinesiskt styre i dystra tecken - nationell säkerhetslag trädde i kraft under årsdagen</td>
<td>https://svenska.yle.fi/artikel/2020/07/01/hongkongborna-uppmarksammade-23-ar-under-kinesiskt-styre-i-dystra-tecken</td>
</tr>
<tr>
<th>5</th>
<td>Att vara kvinna och jägare är att våga ta plats och bevisa sin duglighet</td>
<td>https://svenska.yle.fi/artikel/2020/07/01/att-vara-kvinna-och-jagare-ar-att-vaga-ta-plats-och-bevisa-sin-duglighet</td>
</tr>
<tr>
<th>6</th>
<td>Kanoncomeback av Rasmus Schüller i HJK – visade vägen för stora guldfavoriten i premiären</td>
<td>https://svenska.yle.fi/artikel/2020/07/01/kanoncomeback-av-rasmus-schuller-i-hjk-visade-vagen-for-stora-guldfavoriten-i</td>
</tr>
<tr>
<th>7</th>
<td>Mystisk massdöd bland elefanter i Botswana - ny sjukdom eller gift?</td>
<td>https://svenska.yle.fi/artikel/2020/07/01/mystisk-massdod-bland-elefanter-i-botswana-ny-sjukdom-eller-gift</td>
</tr>
<tr>
<th>8</th>
<td>Coronarestriktionerna sätter sin prägel på sommarens evenemang, folksamlingar på över 500 personer tillåtna utomhus igen – läs det senaste om coronaviruset här</td>
<td>https://svenska.yle.fi/coronavirus</td>
</tr>
<tr>
<th>9</th>
<td>Talvivaaraledare friades - inget insiderbrott när teckningsrätter såldes</td>
<td>https://svenska.yle.fi/artikel/2020/07/01/talvivaaraledare-friades-inget-insiderbrott-nar-teckningsratter-saldes</td>
</tr>
</tbody>
</table>
</div></div>
</div>
<p>Man kan spara nyheterna t.ex. som en <code class="docutils literal notranslate"><span class="pre">csv</span></code> fil med <code class="docutils literal notranslate"><span class="pre">pandas</span></code> funktionen <code class="docutils literal notranslate"><span class="pre">to_csv()</span></code> ifall man tänker använda datan man skrapar från nätet till något mer. Man kan t.ex. räkna statistik om man skrapar numror, eller se hur nyhets rubriker förändras olika dagar om man skrapar nyheter. När man skriver tabllen till en fil behöver man inte bry sig om <code class="docutils literal notranslate"><span class="pre">max_colwidth</span></code>, all data kommer nog med ändå. Hela programmet blir att se ut så här:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">yle</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'https://svenska.yle.fi'</span><span class="p">)</span>
<span class="n">soppa</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">yle</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>

<span class="n">innehall</span> <span class="o">=</span> <span class="n">soppa</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"body"</span><span class="p">)</span>
<span class="n">innehall_lankar</span> <span class="o">=</span> <span class="n">innehall</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>

<span class="n">nyhetsrubriker</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">nyhetslankar</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">lank</span> <span class="ow">in</span> <span class="n">innehall_lankar</span><span class="p">:</span>
  <span class="n">rubrik</span> <span class="o">=</span> <span class="n">lank</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'h3'</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">rubrik</span><span class="p">:</span>
    <span class="n">nyhetsrubriker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rubrik</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">nyhetslankar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'href'</span><span class="p">))</span>

<span class="n">nyheter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Rubrik'</span><span class="p">:</span> <span class="n">nyhetsrubriker</span><span class="p">,</span> <span class="s1">'Länk'</span><span class="p">:</span> <span class="n">nyhetslankar</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nyheter</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">nyheter</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">"yle_nyheter.csv"</span><span class="p">)</span>
</pre></div>
</div>
<p>I nästa kapitel visualiserar vi nyhtetsrubrikerna som ordmoln!</p>
</div>
</div>
<div class="section" id="Konsol">
<h2>Konsol<a class="headerlink" href="#Konsol" title="Permalink till denna rubrik">¶</a></h2>
</div><iframe allowfullscreen="true" allowtransparency="true" frameborder="no" sandbox="allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts" scrolling="no" src="https://repl.it/@kodanka/python?lite=true" style="border: none; width: 100%; height: 500px; padding-bottom: 20px;"></iframe>
<div class="section" id="Quiz">
<h2>Quiz<a class="headerlink" href="#Quiz" title="Permalink till denna rubrik">¶</a></h2>
</div>
</div>
</div>
</div>
<footer><div aria-label="footer navigation" class="rst-footer-buttons" role="navigation"><a accesskey="p" class="btn btn-neutral float-left" href="../latex/" rel="prev" title="LaTeX"><span class="fa fa-arrow-circle-left"></span> Föregående</a>
</div><hr/><div role="contentinfo">© Copyright 2020, Kodanka | Sphinx tema av Read the Docs</div><br/><a href="http://creativecommons.org/licenses/by-nc-sa/4.0"><img alt="Visa licens" src="../_static/by-nc-sa.svg" style="width: 88px; height: 31px;"/></a></footer>
</div>
</div>
</section>
</div>
<script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
</body>
</html>